#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         IPTV Server - Perbaikan untuk Linux Server          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ… PERUBAHAN YANG SUDAH DILAKUKAN:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1ï¸âƒ£  Trust Proxy Configuration"
echo "   âŒ Sebelum: trust proxy: true (terlalu permissive)"
echo "   âœ… Sesudah: Specific untuk private networks"
echo "              ['loopback', '10.0.0.0/8', '172.16.0.0/12', '192.168.0.0/16']"
echo ""
echo "2ï¸âƒ£  IP Detection Logging"
echo "   âŒ Sebelum: Logging selalu aktif â†’ spam log"
echo "   âœ… Sesudah: Hanya log jika DEBUG_IP=true"
echo ""
echo "3ï¸âƒ£  Environment Configuration"
echo "   âœ… File .env untuk konfigurasi production"
echo "   âœ… .env.example sebagai template"
echo ""
echo "4ï¸âƒ£  Stream Stability"
echo "   âœ… AUTO_STOP_DELAY: 300s (5 menit)"
echo "   âœ… CLIENT_TIMEOUT: 90s (3x playlist refresh)"
echo "   âœ… CLEANUP_INTERVAL: 30s"
echo ""
echo "5ï¸âƒ£  Scripts & Documentation"
echo "   âœ… setup-linux-server.sh - Auto setup untuk Linux"
echo "   âœ… TROUBLESHOOTING.md - Panduan lengkap troubleshooting"
echo "   âœ… WSL-vs-LINUX.md - Perbandingan WSL vs Linux Server"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ CARA DEPLOY KE LINUX SERVER:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "# 1. Setup environment"
echo "   ./setup-linux-server.sh"
echo ""
echo "# 2. Edit konfigurasi (optional)"
echo "   nano .env"
echo ""
echo "# 3. Test run"
echo "   npm start"
echo ""
echo "# 4. Install sebagai systemd service"
echo "   ./install-service.sh"
echo ""
echo "# 5. Manage service"
echo "   sudo systemctl start iptv-server"
echo "   sudo systemctl status iptv-server"
echo "   sudo systemctl enable iptv-server"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ” TROUBLESHOOTING:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Masalah IP Detection:"
echo "  1. Enable debug: echo 'DEBUG_IP=true' >> .env"
echo "  2. Restart: sudo systemctl restart iptv-server"
echo "  3. Watch logs: sudo journalctl -u iptv-server -f"
echo ""
echo "Masalah Firewall:"
echo "  Ubuntu: sudo ufw allow 3000/tcp"
echo "  CentOS: sudo firewall-cmd --permanent --add-port=3000/tcp"
echo ""
echo "Masalah Stream Restart Loop:"
echo "  - Tingkatkan timeout di .env"
echo "  - AUTO_STOP_DELAY=300000"
echo "  - CLIENT_TIMEOUT=90000"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“š DOKUMENTASI:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  ğŸ“„ TROUBLESHOOTING.md   - Panduan troubleshooting lengkap"
echo "  ğŸ“„ WSL-vs-LINUX.md      - Perbedaan WSL vs Linux Server"
echo "  ğŸ“„ router-config-guide.sh - Konfigurasi router/proxy"
echo "  ğŸ“„ .env.example         - Template environment variables"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸŒ AKSES SERVER:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "  Admin Panel:"
echo "    http://$SERVER_IP:3000/admin"
echo ""
echo "  Playlist (VLC):"
echo "    http://$SERVER_IP:3000/playlist.m3u8?token=default123"
echo ""
echo "  API Stats:"
echo "    http://$SERVER_IP:3000/api/stats/comprehensive"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
